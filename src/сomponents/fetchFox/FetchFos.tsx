import { useEffect, useState } from 'react';
import Loader from '../loader/Loader';
import MyButton from "../myButton/MyButton";
import './fetchFos.css'

// * 5. –ø—Ä–æ—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
interface IFoxData {
  image: string;
  link: string;
}

export default function FetchFox(): JSX.Element {

  // * 3. —Å–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é useState(). –≤ –Ω–µ–π –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
  const [foxImg, setFoxImg] = useState<string>('');

  // * 7. —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–µ–≥–æ –æ –∑–∞–≥—Ä—É–∑–∫–µ - loader –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  const [loading, setLoading] = useState<boolean>(true);

  // * 1. —Å–æ–∑–¥–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
  const fetchFox = async (): Promise<void> => {
    const res = await fetch('https://randomfox.ca/floof/');
    const data: IFoxData = await res.json();
    // * 4. –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    setFoxImg(data.image);
    // –≤—ã–∫–ª—é—á–∞–µ–º loader –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–≤ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –Ω–∞ false
    setLoading(false);
  };


  // * 8 —Å–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –≤–∫–ª—é—á–∞–µ—Ç loader –∏ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ—Å—ã–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∑–∞ –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  const handleGetFox = () => {
    setLoading(true);
    // setTimeout –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –∑–∞ —Å—á–µ—Ç –Ω–µ–≥–æ loader –∫—Ä—É—Ç–∏—Ç—Å—è –¥–æ–ª—å—à–µ –∏ –Ω–µ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑–∫–æ
    setTimeout(() => {
      fetchFox();
    }, 1000);
  };

  // * 2. –ø–æ–º–µ—Å—Ç–∏–ª–∏ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –≤ useEffect() —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
  useEffect(() => {
    fetchFox();
  }, []);

  return (
    <div className="lesson-container">
      <h2>Fetch fox ü¶ä</h2>
      {/* 6. –¥–æ–±–∞–≤–∏–ª–∏ –≤ –≤–µ—Ä—Å—Ç–∫—É –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –∫–Ω–æ–ø—É —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º onClick –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ */}
      <MyButton text="get fox!" func={handleGetFox} />
      {/* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-–æ–±–µ—Ä—Ç–∫–∞ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞, –∫–∞–∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä—ã —Ä–∞–º–∫–∏ */}

      {/* –µ—Å–ª–∏ –≤ loading true –º—ã –ø–æ–∫–∞–∂–µ–º Loader, –µ—Å–ª–∏ false - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ */}
      {loading ? <Loader /> : (
        <div className="fox-wrapper">
          <img src={foxImg} alt="" />
        </div>
      )}

    </div>
  );
}